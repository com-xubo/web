<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="../js/jquery.js"></script>
</head>
<body>
    <h1>hello world2</h1>
   <script>
        var saInit = function(){
            (function(para) {
                var p = para.sdk_url, n = para.name, w = window, d = document, s = 'script',x = null,y = null;
                if(typeof(w['sensorsDataAnalytic201505']) !== 'undefined') {
                    return false;
                }
                w['sensorsDataAnalytic201505'] = n;
                w[n] = w[n] || function(a) {return function() {(w[n]._q = w[n]._q || []).push([a, arguments]);}};
                var ifs = ['track','quick','register','registerPage','registerOnce','trackSignup', 'trackAbtest', 'setProfile','setOnceProfile','appendProfile', 'incrementProfile', 'deleteProfile', 'unsetProfile', 'identify','login','logout','trackLink','clearAllRegister','getAppStatus'];
                for (var i = 0; i < ifs.length; i++) {
                    w[n][ifs[i]] = w[n].call(null, ifs[i]);
                }
                if (!w[n]._t) {
                    x = d.createElement(s), y = d.getElementsByTagName(s)[0];
                    x.async = 1;
                    x.src = p;
                    x.setAttribute('charset','UTF-8');
                    w[n].para = para;
                    y.parentNode.insertBefore(x, y);
                }
            })({
                show_log: true,
                sdk_url: 'https://cdn.jsdelivr.net/npm/sa-sdk-javascript@1.15.5/sensorsdata.min.js',
                heatmap_url: 'https://cdn.jsdelivr.net/npm/sa-sdk-javascript@1.15.5/heatmap.min.js',
                name: 'sensors',
                server_url: 'https://test-syg.datasink.sensorsdata.cn/sa?token=27f1e21b78daf376&project=xubo'
            });
        }
        
        const identify = function(){
            const search = document.location.search;
            function parseQuery(query){
                let paramEntry = []; 
                if(query.indexOf('&') > 0){
                    paramEntry = query.split('&');
                }else{
                    paramEntry.push(query);
                }
                paramEntry = paramEntry.map((value)=>{
                    return value.split('=');
                });

                let paramsMap = new Map(paramEntry);

                return paramsMap;
            }

            function getQueryValue(query, key){
                if(!query || typeof query !== 'string'){
                    return '';
                }
                if(!key || typeof key !== 'string'){
                    return '';
                }

                let paramObj = parseQuery(query);
                let value = paramObj.get(key);
                return value ? value : '';
            }

            function getOpenid(code){
                $.ajax({
                    url: 'http://www.demo.com:8081/:8081/getOpenid',
                    header: {
                        'content-type': 'application/x-www-form-urlencoded'
                    },
                    method:'POST',
                    data :{
                        code
                    }, 
                    success: function(res){
                        console.log('llll', res)
                    }
                });
            }
            getOpenid('011bj0Qj28UlMA0yuLMj23E7Qj2bj0QG');

            console.log('navigator.userAgent', navigator.userAgent);
            if(navigator.userAgent.match(/miniProgram/i)){
                if( !search || search.indexOf('?') === -1){
                    return;    
                }
                const query = search.slice(1);
                if(search.indexOf('code') >= 0){
                    let code = getQueryValue(query, 'code');

                    sensors.identify(distinctID, true);
                }   
            }
        };
        identify();
        
        // sensors.quick('autoTrack');
</script>

</body>
</html>
